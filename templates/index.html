<!DOCTYPE html>
<html>
<head>
    <title>{{ title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <div class="nav">
        <a href="/config">âš™ Configuration</a>
    </div>
    <h1>{{ heading }}</h1>
    <p class="subtitle">Simulated conveyor belt inspection system</p>
    <div class="camera-grid">
        {% for key, cam in cameras.items() %}
        <div class="camera-card">
            <div class="camera-header">
                <span>{{ cam.label }}</span>
                <span class="topic">{{ cam.topic }}</span>
            </div>
            <div class="camera-feed">
                <img src="/stream/{{ key }}" alt="{{ cam.label }}">
            </div>
            <div class="camera-description">{{ cam.description }}</div>
        </div>
        {% endfor %}
    </div>
    <script>
    // Reconnect MJPEG streams on error with exponential backoff
    document.querySelectorAll('.camera-feed img').forEach(function(img) {
        var baseUrl = img.src.split('?')[0];
        var delay = 1000;
        img.addEventListener('error', function() {
            setTimeout(function() {
                img.src = baseUrl + '?t=' + Date.now();
                delay = Math.min(delay * 2, 10000);
            }, delay);
        });
        img.addEventListener('load', function() { delay = 1000; });
    });
    </script>
</body>
</html>
