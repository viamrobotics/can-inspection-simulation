[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
user=root

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[program:configure-worlds]
command=/opt/configure_worlds.sh
autostart=true
autorestart=false
startsecs=0
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=5

[program:xvfb]
command=/bin/bash -c 'if [ "$LOCAL_MODE" = "local" ]; then /usr/bin/Xvfb :1 -screen 0 1024x768x24; else sleep infinity; fi'
autostart=true
autorestart=true
startsecs=5
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=10

[program:gazebo]
command=/bin/bash -c 'export PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=python GZ_WORLD_NAME=cylinder_inspection GZ_STATION_NAME="Station 1" GZ_OVERVIEW_TOPIC=/overview_camera GZ_INSPECTION_TOPIC=/inspection_camera GZ_SIM_RESOURCE_PATH=/opt/models; if [ "$LOCAL_MODE" = "local" ]; then export DISPLAY=:1; /usr/bin/gz sim -s -r /opt/worlds/cylinder_inspection.sdf; else export LIBGL_ALWAYS_SOFTWARE=0 __GLX_VENDOR_LIBRARY_NAME=nvidia __NV_PRIME_RENDER_OFFLOAD=1 __VK_LAYER_NV_optimus=NVIDIA_only VK_ICD_FILENAMES=/usr/share/vulkan/icd.d/nvidia_icd.json; /usr/bin/gz sim -s -r --headless-rendering /opt/worlds/cylinder_inspection.sdf; fi'
autostart=true
autorestart=true
startsecs=10
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=20

[program:unpause-sim]
command=/bin/bash -c "sleep 10 && /usr/bin/gz service -s /world/cylinder_inspection/control --reqtype gz.msgs.WorldControl --reptype gz.msgs.Boolean --timeout 2000 --req 'pause: false'"
autostart=true
autorestart=false
startsecs=0
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=30

[program:can-spawner]
command=/bin/bash -c "sleep 10 && /usr/bin/python3 /opt/can_spawner.py"
autostart=true
autorestart=true
startsecs=15
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=40

[program:web-viewer]
command=/bin/bash -c "sleep 10 && /usr/bin/python3 /opt/web_viewer.py"
autostart=true
autorestart=true
startsecs=15
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=50

[program:viam-server]
command=/bin/bash -c "if [ -f /etc/viam.json ]; then sleep 10 && /usr/local/bin/viam-server -config /etc/viam.json; else sleep infinity; fi"
autostart=true
autorestart=true
startsecs=15
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=60
